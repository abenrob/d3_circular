<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/style.css">
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

//globals
var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = 700 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom,
    innerradius = height / 5,
    smallradius = height / 11,
    innersquareedge = Math.sqrt(Math.pow((innerradius * 2),2) / 2),
    outerradius = height / 3;

function getXY(classList, reset){
    reset = reset || false;
    var addon = 60;
    if (classList.contains('topcircle')){
        if (!reset){return {"x":width / 2, "y": height / 2 + margin.top - outerradius - addon}}
        else {return {"x":width / 2, "y": height / 2 + margin.top - outerradius}}
    } else if (classList.contains('bottomcircle')){
        if (!reset){return {"x":width / 2, "y": height / 2 + margin.top + outerradius + addon}}
        else {return {"x":width / 2, "y": height / 2 + margin.top + outerradius}}
    } else if (classList.contains('rightcircle')){
        if (!reset){return {"x":width / 2  + outerradius + addon, "y": height / 2 + margin.top}}
        else {return {"x":width / 2  + outerradius, "y": height / 2 + margin.top}}
    } else if (classList.contains('leftcircle')){
        if (!reset){return {"x":width / 2  - outerradius - addon, "y": height / 2 + margin.top}}
        else {return {"x":width / 2  - outerradius, "y": height / 2 + margin.top}}
    }
}

function buildChart(){

    var svg = d3.select("body")
        .append("svg")
            .attr("class","viz")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

    //Draw the Rectangle

    var innercircle = svg.append("g");

    innercircle.append("circle")
        .classed("innergroup", true)
        .classed("innercircle", true)
        .attr("cx", width / 2)
        .attr("cy", height / 2 + margin.top)
        .attr("r", innerradius)
    innercircle.append("text")
        .classed("innergroup", true)
        .classed("innertext", true)
        .attr("x", width / 2)
        .attr("y", height / 2 + margin.top)
        .append("tspan")
            .attr("x", width / 2)
            .attr("y", height / 2 + margin.top + 15 - 40)
            .attr("text-anchor", "middle")
            .text("TITLE OF")
        .append("tspan")
            .attr("x", width / 2)
            .attr("y", height / 2 + margin.top + 15)
            .attr("text-anchor", "middle")
            .text("THE STUDY")
        .append("tspan")
            .attr("x", width / 2)
            .attr("y", height / 2 + margin.top + 15 + 40)
            .attr("text-anchor", "middle")
            .text("GOES HERE")
    var outercircle = svg.append("circle")
        .attr("class", "outercircle")
        .attr("cx", width / 2)
        .attr("cy", height / 2 + margin.top)
        .attr("r", outerradius)
    var topcircle = svg.append("g")
        .classed("topcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top - outerradius) +")"; });
    topcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    topcircle.append("svg:image")
        .attr("xlink:href", "img/icon_CROPS.svg")
        .attr("x", -50)
        .attr("y", -50)
        .attr("width", "100")
        .attr("height", "100");
    var rightcircle = svg.append("g")
        .classed("rightcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2  + outerradius) +","+ (height / 2 + margin.top) +")"; });
    rightcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    rightcircle.append("svg:image")
        .attr("xlink:href", "img/icon_TECHNOLOGIES.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");
    var leftcircle = svg.append("g")
        .classed("leftcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2  - outerradius) +","+ (height / 2 + margin.top) +")"; });
    leftcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    leftcircle.append("svg:image")
        .attr("xlink:href", "img/icon_CLIMATE.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");
    var bottomcircle = svg.append("g")
        .classed("bottomcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top + outerradius) +")"; });
    bottomcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    bottomcircle.append("svg:image")
        .attr("xlink:href", "img/icon_GEOGRAPHY.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");

    d3.selectAll(".smallcircle")
        .on("click",function(d){
            if ( d3.select(this)[0][0].classList.contains("clicked") ) {
                var current = d3.select(this)
                    .classed("clicked", false)
                var others = d3.selectAll(".greycircle")
                    .classed("greycircle", false)
                    
                others.each(function(){
                    var xy = getXY(d3.select(this)[0][0].classList,true);
                    d3.select(this).transition()
                        .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(1)"})
                })
            } else {
                d3.selectAll(".smallcircle")
                    .classed("clicked", false)
                var current = d3.select(this)
                    .classed("clicked",true)
                    .classed("greycircle",false)
                var xy = getXY(d3.select(this)[0][0].classList,true);
                current.transition()
                    .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(1)"})
                
                var others = d3.selectAll(".smallcircle:not(.clicked)")
                    .classed("greycircle",true)  
                others.each(function(){
                    var xy = getXY(d3.select(this)[0][0].classList);
                    d3.select(this).transition()
                        .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(0.7)"})
                })
            }
        })
}
buildChart();
</script>