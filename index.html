<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="css/style.css">
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

//globals
var margin = {top: 30, right: 10, bottom: 30, left: 10},
    width = 700 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom,
    innerradius = height / 5,
    smallradius = height / 11,
    innersquareedge = Math.sqrt(Math.pow((innerradius * 2),2) / 2),
    outerradius = height / 3;

var plotdata = {
    "crops":["rice","maize","wheat"],
    "climate":["maize","wheat"],
    "tech":["rice","maize","wheat","rice","maize","wheat","rice","maize","wheat","rice"],
    "geog":["maize","wheat","rice","maize","wheat","rice"]
}

function getXY(classList, reset){
    reset = reset || false;
    var addon = 70;
    if (classList.contains('topcircle')){
        if (!reset){return {"x":width / 2, "y": height / 2 + margin.top - outerradius - addon}}
        else {return {"x":width / 2, "y": height / 2 + margin.top - outerradius}}
    } else if (classList.contains('bottomcircle')){
        if (!reset){return {"x":width / 2, "y": height / 2 + margin.top + outerradius + addon}}
        else {return {"x":width / 2, "y": height / 2 + margin.top + outerradius}}
    } else if (classList.contains('rightcircle')){
        if (!reset){return {"x":width / 2  + outerradius + addon, "y": height / 2 + margin.top}}
        else {return {"x":width / 2  + outerradius, "y": height / 2 + margin.top}}
    } else if (classList.contains('leftcircle')){
        if (!reset){return {"x":width / 2  - outerradius - addon, "y": height / 2 + margin.top}}
        else {return {"x":width / 2  - outerradius, "y": height / 2 + margin.top}}
    }
}

function buildChart(){

    var svg = d3.select("body")
        .append("svg")
            .attr("class","viz")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);



    var innercircle = svg.append("g")
        .classed("innercircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top) +")"; });
    innercircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", innerradius)
    innercircle.append("text")
        .classed("innergroup", true)
        .classed("maintext", true)
        .attr("x", 0)
        .attr("y", 0)
        .append("tspan")
            .attr("x", 0)
            .attr("y", 15 - 40)
            .attr("text-anchor", "middle")
            .text("TITLE OF")
        .append("tspan")
            .attr("x", 0)
            .attr("y", 15)
            .attr("text-anchor", "middle")
            .text("THE STUDY")
        .append("tspan")
            .attr("x", 0)
            .attr("y", 15 + 40)
            .attr("text-anchor", "middle")
            .text("GOES HERE")
    var outercircle = svg.append("circle")
        .attr("class", "outercircle")
        .attr("cx", width / 2)
        .attr("cy", height / 2 + margin.top)
        .attr("r", outerradius)




    // CROP circle (!!!) at top
    var topcircle = svg.append("g")
        .classed("topcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top - outerradius) +")"; });
    topcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    topcircle.append("svg:image")
        .attr("xlink:href", "img/icon_CROPS.svg")
        .attr("x", -50)
        .attr("y", -50)
        .attr("width", "100")
        .attr("height", "100");

    // orbit surrounding circle
    var toporbit = topcircle.append("g")
        .classed("orbit",true)
        //.attr("transform", function(d) { return "translate(0,0)scale(0)"; });
    toporbit.append("circle")
        .classed("orbitcircle",true)
        .classed("toporbit",true)
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius * 1.75)

    var toporbitplanets = toporbit.selectAll(".topplanets")
        .data(plotdata.crops).enter();
    toporbitplanets.append("circle")
        .classed("planets",true)
        .classed("topcircle",true)
        .attr("cx", function(d,i){
            var ct = plotdata.crops.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("cy", function(d,i){
            var ct = plotdata.crops.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad);
        })
        .attr("r", smallradius / 2)
    toporbitplanets.append("text")
        .classed("microtext",true)
        .text(function(d){return d})
        .attr("text-anchor", "middle")
        .attr("x", function(d,i){
            var ct = plotdata.crops.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("y", function(d,i){
            var ct = plotdata.crops.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad) + 7;
        })




    // technology circle at right
    var rightcircle = svg.append("g")
        .classed("rightcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2  + outerradius) +","+ (height / 2 + margin.top) +")"; });
    rightcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    rightcircle.append("svg:image")
        .attr("xlink:href", "img/icon_TECHNOLOGIES.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");

    //orbit surrounding circle
    var rightorbit = rightcircle.append("g")
        .classed("orbit",true)
        //.attr("transform", function(d) { return "translate(0,0)scale(0)"; });
    rightorbit.append("circle")
        .classed("orbitcircle",true)
        .classed("toporbit",true)
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius * 1.75)

    var rightorbitplanets = rightorbit.selectAll(".rightplanets")
        .data(plotdata.tech).enter();
    rightorbitplanets.append("circle")
        .classed("planets",true)
        .classed("rightcircle",true)
        .attr("cx", function(d,i){
            var ct = plotdata.tech.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("cy", function(d,i){
            var ct = plotdata.tech.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad);
        })
        .attr("r", smallradius / 2)
    rightorbitplanets.append("text")
        .classed("microtext",true)
        .text(function(d){return d})
        .attr("text-anchor", "middle")
        .attr("x", function(d,i){
            var ct = plotdata.tech.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("y", function(d,i){
            var ct = plotdata.tech.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad) + 7;
        })




    // climate circle to left
    var leftcircle = svg.append("g")
        .classed("leftcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2  - outerradius) +","+ (height / 2 + margin.top) +")"; });
    leftcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    leftcircle.append("svg:image")
        .attr("xlink:href", "img/icon_CLIMATE.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");

    //orbit surrounding circle
    var leftorbit = leftcircle.append("g")
        .classed("orbit",true)
        //.attr("transform", function(d) { return "translate(0,0)scale(0)"; });
    leftorbit.append("circle")
        .classed("orbitcircle",true)
        .classed("leftorbit",true)
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius * 1.75)

    var leftorbitplanets = leftorbit.selectAll(".leftplanets")
        .data(plotdata.climate).enter();
    leftorbitplanets.append("circle")
        .classed("planets",true)
        .classed("leftcircle",true)
        .attr("cx", function(d,i){
            var ct = plotdata.climate.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("cy", function(d,i){
            var ct = plotdata.climate.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad);
        })
        .attr("r", smallradius / 2)
   leftorbitplanets.append("text")
        .classed("microtext",true)
        .text(function(d){return d})
        .attr("text-anchor", "middle")
        .attr("x", function(d,i){
            var ct = plotdata.climate.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("y", function(d,i){
            var ct = plotdata.climate.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad) + 7;
        })


    // geography circle at bottom
    var bottomcircle = svg.append("g")
        .classed("bottomcircle", true)
        .classed("smallcircle", true)
        .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top + outerradius) +")"; });
    bottomcircle.append("circle")
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius)
    bottomcircle.append("svg:image")
        .attr("xlink:href", "img/icon_GEOGRAPHY.svg")
        .attr("x", -30)
        .attr("y", -30)
        .attr("width", "60")
        .attr("height", "60");


    //orbit surrounding circle
    var bottomorbit = bottomcircle.append("g")
        .classed("orbit",true)
        //.attr("transform", function(d) { return "translate(0,0)scale(0)"; });
    bottomorbit.append("circle")
        .classed("orbitcircle",true)
        .classed("bottomorbit",true)
        .attr("cx", 0)
        .attr("cy", 0)
        .attr("r", smallradius * 1.75)

    var bottomorbitplanets = bottomorbit.selectAll(".bottomplanets")
        .data(plotdata.geog).enter();
    bottomorbitplanets.append("circle")
        .classed("planets",true)
        .classed("bottomcircle",true)
        .attr("cx", function(d,i){
            var ct = plotdata.geog.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("cy", function(d,i){
            var ct = plotdata.geog.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad);
        })
        .attr("r", smallradius / 2)
   bottomorbitplanets.append("text")
        .classed("microtext",true)
        .text(function(d){return d})
        .attr("text-anchor", "middle")
        .attr("x", function(d,i){
            var ct = plotdata.geog.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.sin(rad);
        })
        .attr("y", function(d,i){
            var ct = plotdata.geog.length,
                dist = smallradius * 1.75,
                deg = (360 / ct) * i,
                rad;
                if (deg > 180){ deg = deg - 180 } 
                else { deg = deg + 180 }
                rad = deg * (Math.PI / 180)
            return dist * Math.cos(rad) + 7;
        })




    d3.selectAll(".orbit")
        .attr("transform", function(d) { return "scale(0)"; });

    d3.select(".innercircle")
        .on("click",function(d){
            d3.selectAll(".orbit")
                    .classed("clicked",false)
                    .transition()
                        .attr("transform", function(d) { return "scale(0)"; });
            d3.select(".innercircle").transition()
                    .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top) +")scale(1)"; });
            var circles = d3.selectAll(".smallcircle")
                .classed("greycircle", false)
            circles.each(function(){
                var xy = getXY(d3.select(this)[0][0].classList,true);
                d3.select(this).transition()
                    .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(1)"})
            })
        })

    d3.selectAll(".smallcircle")
        .on("click",function(d){
            var daOrbit = d3.select(d3.select(this)[0][0].lastChild);
            if ( d3.select(this)[0][0].classList.contains("clicked") ) {
                d3.selectAll(".orbit")
                    .classed("clicked",false)
                    .transition()
                        .attr("transform", function(d) { return "scale(0)"; });
                d3.select(".innercircle").transition()
                    .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top) +")scale(1)"; });
                var current = d3.select(this)
                    .classed("clicked", false)
                var others = d3.selectAll(".greycircle")
                    .classed("greycircle", false)
                    
                others.each(function(){
                    var xy = getXY(d3.select(this)[0][0].classList,true);
                    d3.select(this).transition()
                        .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(1)"})
                })
            } else {
                d3.selectAll(".orbit")
                    .classed("clicked",false)
                    .transition()
                        .attr("transform", function(d) { return "scale(0)"; });
                daOrbit
                    .classed("clicked",true)
                    .transition()
                        .attr("transform", function(d) { return "scale(1)"; });
                d3.select(".innercircle").transition()
                    .attr("transform", function(d) { return "translate("+ (width / 2) +","+ (height / 2 + margin.top) +")scale(.75)"; });
                d3.selectAll(".smallcircle")
                    .classed("clicked", false)
                var current = d3.select(this)
                    .classed("clicked",true)
                    .classed("greycircle",false)
                var xy = getXY(d3.select(this)[0][0].classList,true);
                current.transition()
                    .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(1)"})
                
                var others = d3.selectAll(".smallcircle:not(.clicked)")
                    .classed("greycircle",true)  
                others.each(function(){
                    var xy = getXY(d3.select(this)[0][0].classList);
                    d3.select(this).transition()
                        .attr("transform", function(d) { return "translate("+ xy.x +","+ xy.y +")scale(0.7)"})
                })
            }
        })
}
buildChart();
</script>